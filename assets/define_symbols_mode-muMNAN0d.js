import{U as qe,s as Se,a as v,b as Ie,V as et,W as Be,u as K,X as tt,Y as nt,m as Fe,Z as ee,_ as rt,$ as st,a0 as ot,a1 as ge,a2 as at,a3 as lt,a4 as re,a5 as it,a6 as ct,a7 as ne,x as M,d as z,y as D,a8 as de,a9 as ut,z as J,aa as Ue,ab as je,ac as oe,K as pe,ad as ce,P as dt,k as be,ae as ie,af as Le,ag as W,ah as pt,Q as Z,n as $e,ai as ft,aj as Y,ak as ht,al as _t,l as gt,am as mt,an as vt,ao as X,ap as xt,aq as bt,w as wt,v as I,B as yt,F as At,G as Ct,ar as kt,as as Pt,at as St,au as It,av as Lt,o as $t,aw as Mt,ax as Dt,ay as Et,az as Rt,aA as zt,aB as Tt,aC as Ve,aD as Ot,aE as we,g as ye,aF as Ne,O as Q,aG as ue,aH as qt,L as te,N as ae,aI as Bt,aJ as Ft,aK as Ut,aL as Ae,aM as jt,aN as Vt}from"./index--jBmlGKr.js";import{r as Nt}from"./render_shape-Lm64LU_n.js";function Ht(e){const t=qe(),[n,r]=Se(e,["onCloseAutoFocus","onInteractOutside"]);let u=!1;return v(et,Ie({onCloseAutoFocus:p=>{n.onCloseAutoFocus?.(p),!p.defaultPrevented&&u&&p.preventDefault(),u=!1},onInteractOutside:p=>{n.onInteractOutside?.(p),!p.defaultPrevented&&!t.isModal()&&(u=!0)}},r))}const He=Be();function Wt(){return K(He)}function Yt(){const e=Wt();if(e===void 0)throw new Error("[kobalte]: `useContextMenuContext` must be used within a `ContextMenu` component");return e}function Xt(e){const t=`contextmenu-${tt()}`,{direction:n}=nt();e=Fe({id:t,placement:n()==="rtl"?"left-start":"right-start",gutter:2,shift:2},e);const[r,u]=Se(e,["onOpenChange"]),[h,A]=ee({x:0,y:0}),p=rt({defaultOpen:!1,onOpenChange:b=>r.onOpenChange?.(b)}),_={setAnchorRect:A};return v(He.Provider,{value:_,get children(){return v(st,Ie({get open(){return p.isOpen()},get onOpenChange(){return p.setIsOpen},getAnchorRect:h},u))}})}function Qt(e){const t=qe(),n=ot(),r=Yt();e=Fe({id:t.generateId("trigger")},e);const[u,h]=Se(e,["ref","style","disabled","onContextMenu","onPointerDown","onPointerMove","onPointerCancel","onPointerUp"]);let A=0;const p=()=>{window.clearTimeout(A)};ge(()=>{p()});const _=w=>{if(u.disabled){re(w,u.onContextMenu);return}p(),w.preventDefault(),r.setAnchorRect({x:w.clientX,y:w.clientY}),n.isOpen()?n.focusContent():n.open(!0)},b=w=>w.pointerType==="touch"||w.pointerType==="pen";return v(at,Ie({as:"div",ref(w){var l=lt(n.setTriggerRef,u.ref);typeof l=="function"&&l(w)},get style(){return{"-webkit-touch-callout":"none",...u.style}},get"data-disabled"(){return u.disabled?"":void 0},onContextMenu:_,onPointerDown:w=>{re(w,u.onPointerDown),!u.disabled&&b(w)&&(p(),A=window.setTimeout(()=>n.open(!1),700))},onPointerMove:w=>{re(w,u.onPointerMove),!u.disabled&&b(w)&&p()},onPointerCancel:w=>{re(w,u.onPointerCancel),!u.disabled&&b(w)&&p()},onPointerUp:w=>{re(w,u.onPointerUp),!u.disabled&&b(w)&&p()}},()=>n.dataset(),h))}var We={exports:{}};(function(e,t){(function(n,r){r(e)})(it,function(n){function r(s,d){if(!(s instanceof d))throw new TypeError("Cannot call a class as a function")}/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */function u(s,d,o){if(!Array.isArray(s))throw new TypeError("First argument should be an array");if(s.forEach(function(g){if(!Array.isArray(g)||g.some(function(x){return typeof x!="number"})||g.length!==s[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),s=s.filter(function(g,x){return x===0||!g.every(function(k,P){return k===s[x-1][P]})}),s.length<2)return[];var i=s.length,c=w(s[1],s[0]),m=w(s[i-2],s[i-1]);return h(s,c,m,d,o)}function h(s,d,o,i,c){var m=20,g,x,k,P,L,S,T,O,N,H,R,q,j;if(s.length===2)return q=l.vectorLen(l.subtract(s[0],s[1]))/3,g=[s[0],l.addArrays(s[0],l.mulItems(d,q)),l.addArrays(s[1],l.mulItems(o,q)),s[1]],[g];x=a(s);var B=A(s,x,x,d,o,c);if(g=B[0],P=B[1],S=B[2],P===0||P<i)return[g];if(P<i*i)for(k=x,L=P,T=S,j=0;j<m;j++){k=_(g,s,k);var F=A(s,x,k,d,o,c);if(g=F[0],P=F[1],S=F[2],P<i)return[g];if(S===T){var V=P/L;if(V>.9999&&V<1.0001)break}L=P,T=S}if(R=[],O=l.subtract(s[S-1],s[S+1]),O.every(function(xe){return xe===0})){O=l.subtract(s[S-1],s[S]);var U=[-O[1],O[0]];O[0]=U[0],O[1]=U[1]}return N=l.normalize(O),H=l.mulItems(N,-1),R=R.concat(h(s.slice(0,S+1),d,N,i,c)),R=R.concat(h(s.slice(S),H,o,i,c)),R}function A(s,d,o,i,c,m){var g,x,k;g=p(s,o,i,c);var P=f(s,g,d);return x=P[0],k=P[1],m&&m({bez:g,points:s,params:d,maxErr:x,maxPoint:k}),[g,x,k]}function p(s,d,o,i){var c,m,g,x,k,P,L,S,T,O,N,H,R,q,j,B,F,V=s[0],U=s[s.length-1];for(c=[V,null,null,U],m=l.zeros_Xx2x2(d.length),R=0,q=d.length;R<q;R++)B=d[R],F=1-B,g=m[R],g[0]=l.mulItems(o,3*B*(F*F)),g[1]=l.mulItems(i,3*F*(B*B));for(x=[[0,0],[0,0]],k=[0,0],R=0,q=s.length;R<q;R++)B=d[R],g=m[R],x[0][0]+=l.dot(g[0],g[0]),x[0][1]+=l.dot(g[0],g[1]),x[1][0]+=l.dot(g[0],g[1]),x[1][1]+=l.dot(g[1],g[1]),j=l.subtract(s[R],y.q([V,V,U,U],B)),k[0]+=l.dot(g[0],j),k[1]+=l.dot(g[1],j);return P=x[0][0]*x[1][1]-x[1][0]*x[0][1],L=x[0][0]*k[1]-x[1][0]*k[0],S=k[0]*x[1][1]-k[1]*x[0][1],T=P===0?0:S/P,O=P===0?0:L/P,H=l.vectorLen(l.subtract(V,U)),N=1e-6*H,T<N||O<N?(c[1]=l.addArrays(V,l.mulItems(o,H/3)),c[2]=l.addArrays(U,l.mulItems(i,H/3))):(c[1]=l.addArrays(V,l.mulItems(o,T)),c[2]=l.addArrays(U,l.mulItems(i,O))),c}function _(s,d,o){return o.map(function(i,c){return b(s,d[c],i)})}function b(s,d,o){var i=l.subtract(y.q(s,o),d),c=y.qprime(s,o),m=l.mulMatrix(i,c),g=l.sum(l.squareItems(c))+2*l.mulMatrix(i,y.qprimeprime(s,o));return g===0?o:o-m/g}function a(s){var d=[],o,i,c;return s.forEach(function(m,g){o=g?i+l.vectorLen(l.subtract(m,c)):0,d.push(o),i=o,c=m}),d=d.map(function(m){return m/i}),d}function f(s,d,o){var i,c,m,g,x,k,P,L;c=0,m=Math.floor(s.length/2);var S=C(d,10);for(x=0,k=s.length;x<k;x++)P=s[x],L=$(d,o[x],S,10),g=l.subtract(y.q(d,L),P),i=g[0]*g[0]+g[1]*g[1],i>c&&(c=i,m=x);return[c,m]}var C=function(d,o){for(var i,c=[0],m=d[0],g=0,x=1;x<=o;x++)i=y.q(d,x/o),g+=l.vectorLen(l.subtract(i,m)),c.push(g),m=i;return c=c.map(function(k){return k/g}),c};function $(s,d,o,i){if(d<0)return 0;if(d>1)return 1;for(var c,m,g,x,k,P=1;P<=i;P++)if(d<=o[P]){x=(P-1)/i,g=P/i,m=o[P-1],c=o[P],k=(d-m)/(c-m)*(g-x)+x;break}return k}function w(s,d){return l.normalize(l.subtract(s,d))}var l=function(){function s(){r(this,s)}return s.zeros_Xx2x2=function(o){for(var i=[];o--;)i.push([0,0]);return i},s.mulItems=function(o,i){return o.map(function(c){return c*i})},s.mulMatrix=function(o,i){return o.reduce(function(c,m,g){return c+m*i[g]},0)},s.subtract=function(o,i){return o.map(function(c,m){return c-i[m]})},s.addArrays=function(o,i){return o.map(function(c,m){return c+i[m]})},s.addItems=function(o,i){return o.map(function(c){return c+i})},s.sum=function(o){return o.reduce(function(i,c){return i+c})},s.dot=function(o,i){return s.mulMatrix(o,i)},s.vectorLen=function(o){return Math.hypot.apply(Math,o)},s.divItems=function(o,i){return o.map(function(c){return c/i})},s.squareItems=function(o){return o.map(function(i){return i*i})},s.normalize=function(o){return this.divItems(o,this.vectorLen(o))},s}(),y=function(){function s(){r(this,s)}return s.q=function(o,i){var c=1-i,m=l.mulItems(o[0],c*c*c),g=l.mulItems(o[1],3*c*c*i),x=l.mulItems(o[2],3*c*i*i),k=l.mulItems(o[3],i*i*i);return l.addArrays(l.addArrays(m,g),l.addArrays(x,k))},s.qprime=function(o,i){var c=1-i,m=l.mulItems(l.subtract(o[1],o[0]),3*c*c),g=l.mulItems(l.subtract(o[2],o[1]),6*c*i),x=l.mulItems(l.subtract(o[3],o[2]),3*i*i);return l.addArrays(l.addArrays(m,g),x)},s.qprimeprime=function(o,i){return l.addArrays(l.mulItems(l.addArrays(l.subtract(o[2],l.mulItems(o[1],2)),o[0]),6*(1-i)),l.mulItems(l.addArrays(l.subtract(o[3],l.mulItems(o[2],2)),o[1]),6*i))},s}();n.exports=u,n.exports.fitCubic=h,n.exports.createTangent=w})})(We);var Gt=We.exports;const Kt=ct(Gt);var Zt=M('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=currentColor d="M8 13.75L9.975 11h4.25L8 6.1zM13.775 22l-3.625-7.8L6 20V2l14 11h-7.1l3.6 7.725zm-3.8-11">');const Jt=e=>(()=>{var t=Zt();return ne(t,e,!0,!0),t})(),en=Jt;var tn=M('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=currentColor d="M9.9 19q-2.425 0-4.163-1.575T4 13.5q0-2.35 1.738-3.925T9.9 8h6.3l-2.6-2.6L15 4l5 5l-5 5l-1.4-1.4l2.6-2.6H9.9q-1.575 0-2.738 1T6 13.5Q6 15 7.163 16T9.9 17H17v2z">');const nn=e=>(()=>{var t=tn();return ne(t,e,!0,!0),t})(),rn=nn;var sn=M('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=currentColor d="M19 9V5h-4V3h6v6zM3 21v-6h2v4h4v2zm0-8v-2h2v2zm0-4V7h2v2zm0-4V3h2v2zm4 0V3h2v2zm4 16v-2h2v2zm0-16V3h2v2zm4 16v-2h2v2zm4 0v-2h2v2zm0-4v-2h2v2zm0-4v-2h2v2z">');const on=e=>(()=>{var t=sn();return ne(t,e,!0,!0),t})(),an=on;var ln=M('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=currentColor d="M4.175 21q-.525.125-.913-.262T3 19.825l1-4.775L8.95 20zm4.775-1L4 15.05L15.45 3.6q.575-.575 1.425-.575T18.3 3.6l2.1 2.1q.575.575.575 1.425T20.4 8.55zm7.925-15L6.525 15.35l2.125 2.125L19 7.125z">');const cn=e=>(()=>{var t=ln();return ne(t,e,!0,!0),t})(),un=cn;var dn=M('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=currentColor d="M7 21q-.825 0-1.412-.587T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413T17 21zM17 6H7v13h10zM9 17h2V8H9zm4 0h2V8h-2zM7 6v13z">');const pn=e=>(()=>{var t=dn();return ne(t,e,!0,!0),t})(),fn=pn;var hn=M('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=currentColor d="M7 19v-2h7.1q1.575 0 2.738-1T18 13.5q0-1.5-1.162-2.5T14.1 10H7.8l2.6 2.6L9 14L4 9l5-5l1.4 1.4L7.8 8h6.3q2.425 0 4.163 1.575T20 13.5q0 2.35-1.737 3.925T14.1 19z">');const _n=e=>(()=>{var t=hn();return ne(t,e,!0,!0),t})(),gn=_n,mn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAYAAADwMZRfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEaSURBVHgBlZLNEYIwEIUz6sFj7CAlUEKO3rAESqAD6IB0QDrg6JESoAO0gtBBzMZdJsQIw5t5Q2DZj/3hzBgrnZ/Od+eb89X5xQ7oglfuLNGkEWHgd3AeUyBItGQppTfn3IbPA1fsjwy9BMnDMFiQMcb2fW+7rrNN09gsywjEU5AegvBiDAqllCJInYIoCMJX27ZdQEVRWK31AoHKsE2TghSQSAlUERmSSWVZ0nNJySe8+omP43fwbrCrL8zzvJzzPKfjz4AF0KF8UlVVfpBQVSwccLIlH9xTXdfUzpSCTEKIVf87gIx9//bVuv2GaCvxihOAAe8fIYQjecKgbw82tgHQbENA79j6dz8ECCWwOoXnw4BYHKvRceADWFo2KYwnXVIAAAAASUVORK5CYII=",vn="data:image/svg+xml,%3csvg%20width='17'%20height='16'%20viewBox='0%200%2017%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.22351%2011.1303L1.48438%201.21729L11.7452%202.7825L14.18%209.04337L9.31046%2013.739L3.22351%2011.1303Z'%20fill='white'/%3e%3cpath%20d='M14.89%208.06462C15.0078%208.35943%2015.0433%208.68071%2014.9926%208.99412C14.942%209.30753%2014.8072%209.60131%2014.6025%209.84405L14.5018%209.95445L10.3624%2014.0933C10.1378%2014.3181%209.85635%2014.4776%209.54812%2014.5547C9.23989%2014.6319%208.91648%2014.6238%208.61249%2014.5314L8.47228%2014.4814L3.291%2012.4094C3.0009%2012.2932%202.74717%2012.1016%202.55611%2011.8543C2.36506%2011.607%202.24364%2011.3132%202.20445%2011.0032L1.64803%206.55329C1.63488%206.43939%201.61824%206.31849%201.59896%206.19408L1.53587%205.80507L1.49907%205.60181L1.37639%204.96836L1.28351%204.53468L1.13717%203.88196L0.937387%203.04525L0.590391%201.68549L0.437923%201.1195C0.398644%200.976672%200.395856%200.826266%200.429812%200.682077C0.463769%200.537887%200.533384%200.404528%200.632276%200.294227C0.731168%200.183926%200.856173%200.100212%200.995827%200.0507618C1.13548%200.00131114%201.28532%20-0.0122939%201.43159%200.0111938L1.55953%200.0409823L2.53392%200.299442L3.45223%200.530742L4.28905%200.7305L4.94186%200.876815L5.37648%200.968809L6.00914%201.09234L6.40959%201.16243L6.78462%201.21851L11.4112%201.79676C11.6968%201.8331%2011.969%201.93926%2012.2037%202.10582C12.4385%202.27239%2012.6286%202.49424%2012.7572%202.75174L12.8176%202.88404L14.89%208.06462ZM13.2628%208.71471L11.1904%203.53501L7.09657%203.02334L6.74957%202.98129C6.10494%202.89541%205.46414%202.78287%204.82883%202.64398L4.14009%202.49416L7.02121%205.37489C7.39386%205.27502%207.78905%205.30089%208.14549%205.44848C8.50193%205.59608%208.7997%205.85715%208.99262%206.19121C9.18553%206.52527%209.26281%206.91364%209.21246%207.29609C9.16211%207.67854%208.98695%208.03369%208.71415%208.30645C8.44135%208.57922%208.08615%208.75435%207.70365%208.8047C7.32115%208.85504%206.93272%208.77777%206.59862%208.58488C6.26452%208.39199%206.00341%208.09426%205.85579%207.73787C5.70818%207.38148%205.6823%206.98634%205.78219%206.61374L2.90107%203.73301L2.9773%204.07646L3.12189%204.76335C3.20954%205.19138%203.28551%205.62172%203.34971%206.05389L3.94206%2010.7824L9.12246%2012.8544L13.2628%208.71471ZM16.1491%2010.785C16.3001%2010.9358%2016.3909%2011.1364%2016.4045%2011.3494C16.418%2011.5623%2016.3534%2011.7728%2016.2227%2011.9415L16.1491%2012.0239L12.4321%2015.7404C12.2747%2015.8992%2012.0627%2015.9919%2011.8392%2015.9995C11.6158%2016.0071%2011.3979%2015.929%2011.2302%2015.7812C11.0625%2015.6334%2010.9576%2015.4271%2010.937%2015.2046C10.9164%2014.982%2010.9817%2014.76%2011.1194%2014.5839L11.193%2014.5016L14.9101%2010.785C15.0744%2010.6208%2015.2973%2010.5285%2015.5296%2010.5285C15.762%2010.5285%2015.9848%2010.6208%2016.1491%2010.785Z'%20fill='black'/%3e%3c/svg%3e";var xn=M("<div>"),bn=M("<div><div>"),wn=M("<button>");const fe=Symbol();function yn(e){return e!=null&&typeof e=="object"&&fe in e}function An(e){const t=Symbol(),[n,r]=ee(null,{equals:(_,b)=>!_||!b?_===b:_.item===b.item&&_.hovering===b.hovering&&_.height===b.height&&_.margin_top===b.margin_top&&_.margin_bottom===b.margin_bottom}),u=z(()=>n()!=null),[h,A]=ee(0);let p;return(()=>{var _=xn(),b=p;return typeof b=="function"?de(b,_):p=_,D(_,v(Ue,{get each(){return e.items},children:(a,f)=>{let C,$;const[w,l]=ee(null),y=z(()=>w()!=null);return ge(()=>{$?.()}),(()=>{var s=bn(),d=s.firstChild;return de(o=>{C=o,oe(()=>o[fe]={owner:t,index:f()}),oe(()=>{const i=w();o.style.zIndex=i?"1":"",o.style.position=i?"relative":""})},s),de(o=>{oe(()=>{o.style.pointerEvents=n()?"none":""});let i=null,c=!1;o.style.transformOrigin="top",oe(()=>{c&&(e.disable_clip_path||(o.style.clipPath="inset(0 0 0 0)"));const m=h();if(m===1||m===3){o.style.transform!==""||m===3?(i=o.getBoundingClientRect(),o.style.transition="",o.style.transform=""):(i=null,o.style.transition="");return}else if(m===2){if(i){const P=o.getBoundingClientRect(),L=i.x-P.x,S=i.y-P.y,T=P.width-i.width,O=P.height-i.height;o.style.transition="",e.disable_clip_path||(o.style.clipPath="inset(0 0 "+O+"px "+T+"px)"),c=!0,o.style.transform=["translate("+L+"px, "+S+"px)"].join(" "),i=null,o.offsetHeight,o.style.transition="0.2s transform ease-out, 0.2s clip-path ease-out"}return}const g=w();if(g){o.style.transition="",o.style.transform="translate("+g.x+"px, "+g.y+"px)";return}o.style.transition="0.2s transform, 0.2s clip-path";const x=n();if(!x){o.style.transform="";return}const k=f();if(x.item>k){if(x.hovering<=k){o.style.transform="translateY("+x.height+"px)";return}}else if(x.hovering>=k){o.style.transform="translateY(-"+x.height+"px)";return}o.style.transform=""})},d),D(d,v(Ye.Provider,{value:{selfIsDragging:y,dragging:n,setDragging:r,get wrapper_el(){return C},get container_el(){return p},index:f,selfDragging:w,setSelfDragging:l,list_symbol:t,flipState:h,setFlipState:A,setItems:o=>e.setItems(o),set cleanFn(o){$=o},get cleanFn(){return $}},get children(){return ut(()=>e.children(a,y,f,u))}})),J(o=>{var i=e.wrapper_class,c=e.nodeClass(y);return i!==o.e&&pe(s,o.e=i),c!==o.t&&pe(d,o.t=c),o},{e:void 0,t:void 0}),s})()}})),J(a=>{var f=(n()?.margin_top??0)+"px",C=(n()?.margin_bottom??0)+"px";return f!==a.e&&((a.e=f)!=null?_.style.setProperty("padding-top",f):_.style.removeProperty("padding-top")),C!==a.t&&((a.t=C)!=null?_.style.setProperty("padding-bottom",C):_.style.removeProperty("padding-bottom")),a},{e:void 0,t:void 0}),_})()}const Ye=Be();function Me(e,t,n){return(e-t[0])/t[1]*n[1]+n[0]}function Cn(e){const t=K(Ye);if(!t)throw new Error("dragbutton used outside of draggable");return(()=>{var n=wn();return n.$$pointerdown=r=>{if(!r.isPrimary||t.dragging())return;r.preventDefault();const u=c=>{const m=t.wrapper_el.getBoundingClientRect();t.setDragging({item:t.index(),hovering:c,height:m.height,margin_top:a,margin_bottom:f})};t.setSelfDragging({x:0,y:0});const h=r.pageX,A=r.pageY,p=t.container_el.getBoundingClientRect(),_=t.wrapper_el.getBoundingClientRect(),b=p.height;let a=0,f=b;t.setFlipState(3),u(t.index());const C=t.container_el.getBoundingClientRect(),$=t.wrapper_el.getBoundingClientRect(),w=r.clientY-_.top,l=Me(w,[0,_.height],[0,$.height]);a=_.top-$.top+(w-l),f=p.height-(C.height-b)-a,u(t.index()),t.setFlipState(2),t.setFlipState(0);const y=c=>{const m=c.pageX-h,g=c.pageY-A;t.setSelfDragging({x:m,y:g});const x=document.elementFromPoint(c.clientX,c.clientY);yn(x)&&x[fe].owner===t.list_symbol?u(x[fe].index):u(t.index())},s=c=>ce(()=>{c.isPrimary&&(c.preventDefault(),c.stopImmediatePropagation(),y(c))}),d=c=>{if(!c.isPrimary)return;c.preventDefault(),c.stopImmediatePropagation(),y(c);const m=t.dragging(),g=t.index();if(m){t.setFlipState(3);const x=m.hovering;t.setItems(T=>{const O=[...T],N=O.splice(g,1);return O.splice(x,0,...N),O});const k=t.wrapper_el.getBoundingClientRect(),P=c.clientY-k.top;t.setDragging(null);const L=t.wrapper_el.getBoundingClientRect(),S=Me(P,[0,k.height],[0,L.height]);document.documentElement.scrollTop-=k.top-L.top+(P-S),t.setFlipState(2)}ce(()=>{t.setFlipState(0),i()})},o=c=>{c.isPrimary&&(c.preventDefault(),c.stopImmediatePropagation(),ce(()=>i()))};document.addEventListener("pointermove",s,{capture:!0}),document.addEventListener("pointerup",d,{capture:!0}),document.addEventListener("pointercancel",o,{capture:!0});const i=()=>ce(()=>{t.cleanFn=void 0,t.setDragging(null),t.setSelfDragging(null),document.removeEventListener("pointermove",s,{capture:!0}),document.removeEventListener("pointerup",d,{capture:!0}),document.removeEventListener("pointercancel",o,{capture:!0})});if(t.cleanFn)throw new Error("attempt to double register fn");t.cleanFn=i},n.$$keydown=r=>{if(t.dragging())return;const u=t.index();r.code==="ArrowUp"?(r.preventDefault(),r.stopPropagation(),t.setItems(h=>{const A=Math.max(u-1,0),p=[...h],_=p.splice(u,1);return p.splice(A,0,..._),p}),r.currentTarget.focus()):r.code==="ArrowDown"&&(r.preventDefault(),r.stopPropagation(),t.setItems(h=>{const A=Math.min(u+1,h.length),p=[...h],_=p.splice(u,1);return p.splice(A,0,..._),p}),r.currentTarget.focus())},n.style.setProperty("touch-action","none"),D(n,()=>e.children),J(()=>pe(n,e.class)),n})()}je(["keydown","pointerdown"]);let he=0;function kn(){he++,he===1&&(window.onbeforeunload=function(e){return"You have unsaved changes."})}function Pn(){he-=1,he===0&&(window.onbeforeunload=()=>{})}function Sn(){return kn(),ge(()=>{Pn()}),[]}function In(e){function t(a,f){e.applyAction(a.current_state,f),e.displayAction?.(a,f),a.redo_history=[]}function n(a,f){e.undoAction(a.current_state,f),e.displayAction?.(a,f)}function r(a){return a.history.length>0||e.hasPreview(a)}function u(a){if(e.hasPreview(a)){const f=a.redo_history;a.redo_history.length!==0&&(a.redo_history=[]);const C=a.history.length;return e.commitPreview(a),a.history.length!==C?"pushed_actions":(a.redo_history=f,"undid_actions")}return"no_preview"}function h(a){if(u(a)!=="undid_actions")for(;;){const f=a.history.pop();if(f==null)return;e.undoAction(a.current_state,f),e.displayAction?.(a,f),a.redo_history.push(f);const C=a.history[a.history.length-1];if(!(C!=null&&e.groupActionWithNext?.(C)))break}}function A(a){return a.redo_history.length>0&&!e.hasPreview(a)}function p(a){if(!e.hasPreview(a))for(;;){const f=a.redo_history.pop();if(f==null)return;if(e.applyAction(a.current_state,f),e.displayAction?.(a,f),a.history.push(f),!e.groupActionWithNext?.(f))break}}function _(a,f){if(e.hasPreview(a))throw new Error("must execCommitProgress before execAndSaveActions");e.applyAction(a.current_state,f),e.displayAction?.(a,f),a.history.push(f),a.redo_history=[]}function b(a,f){e.hasPreview(a)&&e.commitPreview(a),a.current_state=f,a.history=[],a.redo_history=[]}return{execCommitProgress:u,execNoSaveAction:t,execNoSaveUnapplyAction:n,checkUndoAvailable:r,execUndo:h,checkRedoAvailable:A,execRedo:p,execAndSaveAction:_,execClearAll:b,checkHasPreview:e.hasPreview}}var Xe=M('<div class="w-full h-full">'),Qe=M('<div class="w-full h-full flex items-center justify-center">'),Ln=M('<svg class="w-full h-full"viewBox="-20 -20 140 140"fill=none xmlns=http://www.w3.org/2000/svg><circle r=24 fill=#2955F4></circle><path stroke-width=12 stroke=#2955F4 stroke-linecap=round stroke-linejoin=round>'),$n=M('<svg class="w-full h-full"viewBox="-20 -20 140 140"fill=none xmlns=http://www.w3.org/2000/svg><circle r=12 fill=#2955F4>'),Mn=M("<svg><path stroke-width=6 stroke=#2955F4 stroke-linecap=round stroke-linejoin=round></svg>",!1,!0),Dn=M("<div class=pb-2>"),En=M('<div class="h-80 overflow-x-clip overflow-y-auto border-y border-ui-bg-300 transition-colors duration-100"><div class="grid grid-flow-row grid-cols-4 gap-x-4 gap-y-4">'),Rn=M("<div>"),zn=M("<div class=w-[0.875rem]>"),Tn=M('<button class="flex flex-col relative"><div class="w-full aspect-square ring-1 ring-ui-bg-300 peer-focus-visible:outline outline-2 outline-ui-hl-600 outline-offset-2 ring-inset ui-checked:ring-2 ui-checked:ring-ui-hl-600 rounded">'),De=M('<div class="flex flex-row gap-4"><div class="flex-1 flex flex-col">'),On=M('<div class="flex flex-wrap items-center">Total duration: <!> sec <button>'),qn=M('<button class="flex flex-row gap-2 text-[#3451b2] items-center"><span>Add pause'),Bn=M('<div class="flex flex-row gap-1 items-center"><div class="aspect-square w-7">'),Fn=M('<div class="w-22 my-1 h-8">'),Un=M("<div class=flex-1>");const le={duration:1};function me(e,t){const n=e.current_state.shapeset_value.shapes;Object.hasOwn(n,t)||E.execAndSaveAction(e,{kind:"update_pattern",pattern:t,old_pattern:null,new_pattern:{strokes:[]}})}function ve(e,t){E.execAndSaveAction(e,{kind:"undo_point"})}function _e(e,t,n){me(e,t);const u=e.current_state.shapeset_value.shapes[t];E.execAndSaveAction(e,{kind:"update_pattern",old_pattern:u,new_pattern:{strokes:[...u.strokes,...n]},pattern:t}),ve(e)}function se(e,t,n){me(e,t);const u=e.current_state.shapeset_value.shapes[t];E.execAndSaveAction(e,{kind:"update_pattern",old_pattern:u,new_pattern:{strokes:n},pattern:t}),ve(e)}function Ge(e,t){const r=e.current_state.shapeset_value.shapes[t];E.execAndSaveAction(e,{kind:"update_pattern",pattern:t,old_pattern:r,new_pattern:null}),ve(e)}const E=In({applyAction(e,t){if(e==null)throw new Error("vs == null");if(t.kind==="update_pattern")t.new_pattern==null?delete e.shapeset_value.shapes[t.pattern]:e.shapeset_value.shapes[t.pattern]=t.new_pattern;else if(t.kind!=="undo_point")throw new Error("todo impl applyAction "+t)},undoAction(e,t){if(e==null)throw new Error("vs == null");if(t.kind==="update_pattern")t.old_pattern==null?delete e.shapeset_value.shapes[t.pattern]:e.shapeset_value.shapes[t.pattern]=t.old_pattern;else if(t.kind!=="undo_point")throw new Error("todo impl undoAction "+t)},displayAction(e,t){t.kind!=="undo_point"&&e.shape!==t.pattern&&(e.shape=t.pattern)},hasPreview(e){return e.next_pattern!=null&&e.next_pattern.points.length>1||e.next_drag!=null||e.pencil_line!=null},commitPreview(e){const t=e.next_drag;e.next_drag=void 0,t!=null&&(e.history.push(t),ve(e,t.pattern));const n=e.pencil_line;if(e.pencil_line=void 0,n!=null)if(n.length===1)_e(e,e.shape,[{...le,points:[{pos:n[0],prev_control_offset:[0,0],next_control_offset:[0,0]}]}]);else{const r=[500,500],h=Kt(n.map(b=>I.mul(b,r)),10),A=[],p=h[h.length-1];p!=null&&h.push([p[3],p[3],[0,0],[0,0]]);const _=h[0];_!=null&&h.unshift([[0,0],[0,0],_[0],_[0]]);for(let b=1;b<h.length;b++){const[a,f]=h[b],[C,$,w,l]=h[b-1],y=I.div(a,r);A.push({pos:y,prev_control_offset:I.sub(I.div(w,r),y),next_control_offset:I.sub(I.div(f,r),y)})}A.length>0&&_e(e,e.shape,[{...le,points:A}])}e.next_pattern=void 0},groupActionWithNext(e){return e.kind!=="undo_point"}});function Ke(e,t){const n=e.current_state.shapeset_value.shapes[t]??void 0,r=e.saved_patterns.get(t)??void 0;return n!==r}function G(e){return E.checkHasPreview(e)||Object.keys(e.current_state.shapeset_value.shapes).some(t=>Ke(e,t))}function Ze(e,t){let n=[];const r=(_,b)=>_+b.map(a=>a.toFixed(0)).join(",");function u(_){const b=I.div(I.sub(_,h[0]),h[1]);return I.add(A[0],I.mul(b,A[1]))}let h=[[0,0],[1,1]],A=[[0,0],[100,100]];if(t?.fullsize){let _=[1/0,1/0],b=[-1/0,-1/0];for(const C of e.points)_=I.min(C.pos,_),b=I.max(C.pos,b);const a=I.sub(b,_),f=Vt([[0,0],[100,100]],a[0]/a[1]);h=[_,[a[0]||1,a[1]||1]],A=f}let p=null;for(const[_,b]of e.points.entries())if(_===0)p=u(b.pos),n.push(r("M",[...u(b.pos)])),n.push(r("l",[0,0]));else{const a=e.points[_-1],f=I.add(a.pos,a.next_control_offset),C=I.add(b.pos,b.prev_control_offset);n.push(r("C",[...u(f),...u(C),...u(b.pos)]))}return{d:n.join(" "),first_pt:p}}function jn(e){const t=z(()=>e.stroke!=null?Ze(e.stroke,{fullsize:!0}):null);return(()=>{var n=Xe();return D(n,(()=>{var r=z(()=>e.stroke.points.length===0);return()=>r()?(()=>{var u=Qe();return D(u,v(Y,{tag:"pause",class:"text-xl text-ui-bg-400",label:"Delay"})),u})():(()=>{var u=Ln(),h=u.firstChild,A=h.nextSibling;return J(p=>{var _=t()?.first_pt?.[0],b=t()?.first_pt?.[1],a=t()?.d;return _!==p.e&&te(h,"cx",p.e=_),b!==p.t&&te(h,"cy",p.t=b),a!==p.a&&te(A,"d",p.a=a),p},{e:void 0,t:void 0,a:void 0}),u})()})()),n})()}function Ee(e){return(()=>{var t=Xe();return D(t,(()=>{var n=z(()=>e.shape==null);return()=>n()?(()=>{var r=Qe();return D(r,v(Y,{tag:"add",class:"text-xl text-ui-bg-400",label:"Create"})),r})():(()=>{var r=$n(),u=r.firstChild;return D(r,()=>e.shape.strokes.map(h=>(()=>{var A=Mn();return J(()=>te(A,"d",Ze(h).d)),A})()),null),J(h=>{var A=(e.shape.strokes[0]?.points[0]?.pos[0]??-100)*100,p=(e.shape.strokes[0]?.points[0]?.pos[1]??-100)*100;return A!==h.e&&te(u,"cx",h.e=A),p!==h.t&&te(u,"cy",h.t=p),h},{e:void 0,t:void 0}),r})()})()),t})()}function Vn(){const{state:e,setState:t}=K(ae),n=()=>e().modes.define_symbols,r=z(()=>{const h=n().current_state;return h.shapeset_tag!=null?W(h.shapeset_tag).tag:"other"}),u=()=>{const h=n().current_state;return h.shapeset_tag!=null&&W(h.shapeset_tag).tag,Ve(r(),h.shapeset_value)};return v(Mt,{get value(){return n().shape},onChange:h=>{n().shape=h,t()},get children(){return[(()=>{var h=Dn();return D(h,v(kt,{children:"Patterns"})),h})(),(()=>{var h=En(),A=h.firstChild;return de(p=>{function _(){p.scrollTop<=0?p.style.borderTopColor="transparent":p.style.borderTopColor="",p.scrollTop>=p.scrollHeight-p.clientHeight?p.style.borderBottomColor="transparent":p.style.borderBottomColor=""}p.addEventListener("scroll",()=>{_()},{passive:!0}),new ResizeObserver(_).observe(p),_()},h),D(A,v(Ue,{get each(){return u()},children:p=>{const _=()=>n().current_state.shapeset_value,b=z(()=>p===n().shape);let[a,f]=ee(void 0,{equals:!1});const C=z(()=>Object.hasOwn(_().shapes,p)?_().shapes[p]:null);oe(()=>{if(b()){f(void 0);const s=setInterval(()=>f(void 0),1e3);ge(()=>clearInterval(s))}else f(void 0)});const $=z(()=>(a(),Ke(n(),p)||b()&&E.checkHasPreview(n()))),w=()=>C()!=null,[l,y]=ee(!1);return v(Pt,{value:p,class:"flex flex-col relative",get children(){return[v(St,{class:"peer"}),v(It,{class:"aspect-square ring-1 ring-ui-bg-300 peer-focus-visible:outline outline-2 outline-ui-hl-600 outline-offset-2 ring-inset ui-checked:ring-2 ui-checked:ring-ui-hl-600 rounded",get children(){return a(),v(Ee,{get shape(){return C()}})}}),v(Lt,{class:"flex flex-row items-center p-1",get children(){return[z(()=>z(()=>!!w())()?zn():null),(()=>{var s=Rn();return D(s,(()=>{var d=z(()=>r()==="objd");return()=>d()?$t[p.startsWith("obj_")?p.substring(4):p]??p:p})(),null),D(s,()=>$()?"*":null,null),J(()=>pe(s,"flex-1 text-center "+($()?"text-red-600 font-bold":""))),s})(),z(()=>z(()=>!!w())()?v(Bt,{get open(){return l()},onOpenChange:s=>y(s),get children(){return[v(Ft,{get children(){return v(Y,{tag:"more_vert",class:"text-sm",label:"More"})}}),v(Ne,{get children(){return v(Ut,{class:"mt-1 dropdown-menu__content-animations max-h-[var(--kb-popper-content-available-height)] overflow-y-auto min-w-[220px] p-2 bg-white rounded border border-ui-bg-300 shadow outline-none origin-[var(--kb-menu-content-transform-origin)] flex flex-col gap-2",get children(){return[v(we,{class:ye,onSelect:()=>(async()=>{t();const s=p,d=await ie(Ae({title:"Rename Shape",label:"Name",placeholder:"my pattern",default_value:s,action_label:"Rename"}));if(d==null)return;if(Object.hasOwn(n().current_state.shapeset_value.shapes,d))throw new Error("Shape named `"+d+"` already exists.");const o=n().current_state.shapeset_value.shapes[s];if(o==null)throw new Error("attempt to rename non-existent shape");const i=n().shape;E.execAndSaveAction(n(),{kind:"update_pattern",pattern:d,old_pattern:null,new_pattern:o}),E.execAndSaveAction(n(),{kind:"update_pattern",pattern:s,old_pattern:o,new_pattern:null}),E.execAndSaveAction(n(),{kind:"undo_point"}),n().shape=i,n().shape===s&&(alert("updsel: "+n().shape+", "+s+", "+d),n().shape=d),t()})().catch(Z),get children(){return[v(Y,{class:"text-xl",tag:"edit",label:"Rename"}),"Rename"]}}),v(we,{class:ye+" text-red-600",onSelect:()=>{Ge(n(),p),t()},get children(){return[v(Y,{class:"text-xl",tag:"delete",label:"Delete"}),"Delete"]}})]}})}})]}}):null)]}})]}})}}),null),D(A,(()=>{var p=z(()=>r()!=="objd");return()=>p()?(()=>{var _=Tn(),b=_.firstChild;return _.$$click=()=>{(async()=>{const a=await ie(Ae({title:"Shape Name",label:"Name",placeholder:"my pattern",action_label:"Create"}));a!=null&&(me(n(),a),E.execAndSaveAction(n(),{kind:"undo_point"}),n().shape=a,t())})().catch(Z)},D(b,v(Ee,{shape:null})),_})():null})(),null),h})()]}})}const Ce={name:"Pencil",hotkeys:["Shift+P"],callback(e,t){const n=e.modes.define_symbols;n.tool="pencil",t()}},ke={name:"Pen",hotkeys:["P"],callback(e,t){const n=e.modes.define_symbols;n.tool="pen",t()}},Pe={name:"Select",hotkeys:["V"],callback(e,t){const n=e.modes.define_symbols;n.tool="move",t()}},Re={name:"Edit Define Rect",hotkeys:[],callback(e,t){const n=e.modes.define_symbols;n.tool="define_rect",t()}},ze=Dt((e,t)=>{const n=e.modes.define_symbols;E.execUndo(n),t()}),Te=Et((e,t)=>{const n=e.modes.define_symbols;E.execRedo(n),t()}),Nn={name:"Clear",hotkeys:[],callback(e,t){const n=e.modes.define_symbols;Object.hasOwn(n.current_state.shapeset_value.shapes,n.shape)&&(Ge(n,n.shape),t())}},Hn={name:"End Pen Line",hotkeys:["Escape"],callback(e,t){const n=e.modes.define_symbols,r=n.next_pattern;r!=null&&n.shape!=null&&(r.points.length>1&&(E.execCommitProgress(n),_e(n,n.shape,[r])),n.next_pattern=void 0)}};function Je(e){return W(e.current_state.shapeset_tag??"").from!=="local"}const Oe={name:"Save",hotkeys:["$mod+s"],callback(e,t){(async()=>{const n=e.modes.define_symbols;if(!G(n))return;E.execCommitProgress(n);let r=n.current_state.shapeset_tag;if(Je(n)||r==null){const h=r!=null?W(r).tag:"other";let A=await ie(Ae({title:"Save As",label:"Patternset Name",placeholder:"My Patternset",action_label:"Save As"}));if(A==null)return;r=await Rt(h,A)}n.current_state.shapeset_tag=r;const u=new Map(Object.entries(n.current_state.shapeset_value.shapes));t(),await zt(r,n.current_state.shapeset_value),n.saved_patterns=u,t()})().catch(Z)}},Wn={move:{icon:"arrow_selector_tool",label:"Edit Curve",action:Pe},pen:{icon:"ink_pen",label:"Vector Pen",action:ke},pencil:{icon:"stylus",label:"Freehand Pencil",action:Ce}},Qn={config:{supports_line_thickness:!0},actions:[Ce,ke,Pe,ze,Te,Hn,Re,Oe],backgroundPanel(){const{state:e,setState:t}=K(ae),n=()=>e().modes.define_symbols;return z((()=>{var r=z(()=>!!G(n()));return()=>r()?v(Sn,{}):null})())},sidePanel(e){const{state:t,setState:n}=K(ae),r=()=>t().modes.define_symbols,u=()=>Je(r()),h=()=>{const a=W(r().current_state.shapeset_tag??"").from;return a==="local"||a==="import"},A=z(()=>{const a=r().current_state.shapeset_value.shapes[r().shape]?.strokes;return a??[]}),p=z(()=>{const a=A();if(a==null)return 0;let f=0;for(const C of a)f+=C.duration??1;return f}),_=a=>{if(a==null){E.execClearAll(r(),{shapeset_tag:null,shapeset_value:{shapes:{}}}),r().shape="Default",r().saved_patterns=new Map,n();return}Tt(a).then(f=>{E.execClearAll(r(),{shapeset_tag:a,shapeset_value:f});const C=Ve(W(a).tag,f);r().shape=C[0],r().saved_patterns=new Map(Object.entries(f.shapes)),n()}).catch(Z)},b=a=>v(Ne,{get children(){return v(Ht,{class:Ot,get children(){return v(we,{class:ye+" text-red-500",onClick:()=>{const f=[...r().current_state.shapeset_value.shapes[r().shape]?.strokes??[]],C=f.indexOf(a.item);C!=-1&&(f.splice(C,1),se(r(),r().shape,f),n())},children:"Delete"})}})}});return[v($e,{collapsible:"Define Symbols",get children(){return[v(dt,{get shapeset(){return r().current_state.shapeset_tag},setShapeset:a=>{_(a)},allowNew:!0,get disabled(){return G(r())},noAutoSelect:!0}),[(()=>{var a=De(),f=a.firstChild;return D(f,v(be,{view:"destructive",get label(){return G(r())?"Discard Changes":"Delete Patternset"},icon:"delete",onClick:()=>{(async()=>{if(G(r())){if(!await ie(Le({title:"Discard unsaved changes?",description:"This cannot be undone.",action_label:"Discard Changes"})))return;_(r().current_state.shapeset_tag)}else{const C=r().current_state.shapeset_tag;if(C==null)throw new Error("should not be possible");if(!await ie(Le({title:"Delete patternset?",description:"This cannot be undone. Patternset: "+W(C).name,action_label:"Delete"})))return;await pt(C),_(null)}})().catch(Z)},get disabled(){return z(()=>!G(r()))()&&!h()}})),a})(),(()=>{var a=De(),f=a.firstChild;return D(f,v(be,{get label(){return u()?"Save As...":"Save"},icon:"save",onClick:()=>(async()=>{Oe.callback(t(),n)})().catch(Z),get disabled(){return!G(r())}})),D(a,v(be,{label:"Export",hide_label:!0,icon:"download",onClick:()=>{const C=r().current_state.shapeset_tag;if(C==null)return Z(new Error("shapeset tag is null"));const $=W(C),w=JSON.stringify({meta:{name:$.name,tag:$.tag},content:r().current_state.shapeset_value}),l=$.tag+"_"+$.name,y=URL.createObjectURL(new Blob([new TextEncoder().encode(w)])),s=document.createElement("a");s.style.display="none",s.href=y,s.download=l+".tapset",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(y)}}),null),a})(),v(Vn,{})]]}}),v($e,{collapsible:"Sequence",get children(){return[v(ft,{get when(){return A().length>0},get fallback(){return"No strokes"},get children(){return[(()=>{var a=On(),f=a.firstChild,C=f.nextSibling,$=C.nextSibling,w=$.nextSibling;return D(a,()=>p().toFixed(2),C),w.$$click=()=>{const l=p(),y=prompt("Total duration",l.toFixed(2));if(y==null)return;const s=+y;if(!s||s<0)return;const d=s/l,o=[...r().current_state.shapeset_value.shapes[r().shape]?.strokes??[]];for(let i=0;i<o.length;i++){const c=o[i];o[i]={...c,duration:(c.duration??1)*d}}se(r(),r().shape,o),n()},D(w,v(Y,{class:"text-xl",tag:"edit",label:"Edit"})),a})(),v(An,{get items(){return A()},setItems:a=>{const f=[...r().current_state.shapeset_value.shapes[r().shape]?.strokes??[]];se(r(),r().shape,a(f)),n()},wrapper_class:"",nodeClass:a=>"",disable_clip_path:!0,children:(a,f,C,$)=>v(Xt,{get children(){return[v(Qt,{as:"div",get class(){return"flex flex-row gap-3 items-center h-10 pr-1 transition-all duration-100 rounded-md hover:bg-[#f4f4f4] "+(f()?"shadow-md ring-1 ring-figma-grey-200 bg-white ":"")},onmouseenter:()=>{r().hover_sequence_item=a,n()},onmouseleave:()=>{r().hover_sequence_item===a&&(r().hover_sequence_item=void 0,n())},get children(){return[(()=>{var w=Bn(),l=w.firstChild;return D(w,v(Cn,{class:"",get children(){return v(Y,{label:"Drag",tag:"drag_handle",class:"text-md text-[#898989]"})}}),l),D(l,v(jn,{stroke:a})),w})(),(()=>{var w=Fn();return D(w,v(ht,{get value(){return a.duration??1},setValue:l=>{const y=[...r().current_state.shapeset_value.shapes[r().shape]?.strokes??[]],s=y.indexOf(a);s!=-1&&(y[s]={...y[s],duration:l},se(r(),r().shape,y),n())},skip_set_value_on_input:!0,unit:"sec",min:0,max:2,step:.1,decimals:2})),w})(),(()=>{var w=Un();return D(w,(()=>{var l=z(()=>a.points.length!==0);return()=>l()?v(_t,{get value(){return a.easing_function??null},setValue:y=>{const s=[...r().current_state.shapeset_value.shapes[r().shape]?.strokes??[]],d=s.indexOf(a);d!=-1&&(s[d]={...s[d],easing_function:y==="ease_in"?"ease_in":y==="ease_out"?"ease_out":y==="ease_in_out"?"ease_in_out":void 0},se(r(),r().shape,s),n())},noAutoSelect:!0,choices:[["ease_in","Ease In"],["ease_out","Ease Out"],["ease_in_out","Ease In Out"]],names:{none:"Linear",empty_list:"*EMPTY_LIST*"}}):null})()),w})()]}}),v(b,{item:a})]}})})]}}),(()=>{var a=qn(),f=a.firstChild;return a.$$click=()=>{_e(r(),r().shape,[{...le,points:[]}]),n()},D(a,v(Y,{label:"Add",tag:"add",class:"text-xl"}),f),a})(),v(gt,{})]}})]},toolsPanel(){const{state:e,setState:t}=K(ae),n=()=>e().modes.define_symbols;return v(mt,{tools_cfg:Wn,get value(){const r=n().tool;if(r!=="define_rect")return r},setValue:r=>{n().tool=r,t()}})},dock2Panel(){const{state:e,setState:t}=K(ae),n=()=>e().modes.define_symbols,r=vt(()=>n().tool);return[v(X,{get value(){return r("move")},action:Pe,get children(){return v(en,{})}}),v(X,{get value(){return r("pen")},action:ke,get children(){return v(xt,{})}}),v(X,{get value(){return r("pencil")},action:Ce,get children(){return v(un,{})}}),v(X,{get value(){return r("define_rect")},action:Re,get children(){return v(an,{})}}),v(bt,{}),v(X,{get disabled(){return!E.checkUndoAvailable(n())},action:ze,get children(){return v(gn,{})}}),v(X,{get disabled(){return!E.checkRedoAvailable(n())},action:Te,get children(){return v(rn,{})}}),v(X,{get disabled(){return!Object.hasOwn(n().current_state.shapeset_value.shapes,n().shape)},action:Nn,get children(){return v(fn,{})}})]},render({state:e,imev:t,frame:n}){const{ctx:r}=t,u=e.modes.define_symbols;u.tool!=="pen"&&(u.next_pattern=void 0);const h=wt(e,n,t,{enable_resize:u.tool==="define_rect",show_inner_preview:!0,show_preview:!0});if(u.shape==null)return;const A=u.shape,p=u.current_state.shapeset_value.shapes,_=Object.hasOwn(p,A)?p[A]:{strokes:[]},b=l=>{const y=Q(n,l);return ue(e.define_rect,n,y)},a={...le,points:[...u.next_pattern?.points??[]]};let f=null;u.tool==="pen"?t.mouse.pos!=null&&(f={pos:b(t.mouse.pos),prev_control_offset:[0,0],next_control_offset:[0,0]},a.points.push(f)):u.next_pattern=void 0;const C=[..._.strokes,...a.points.length>0?[a]:[]];function $(l,y,s,d){const o=4/n.scale,i=s==="pos"?l.pos:I.add(l.pos,l[s]);r.strokeStyle="#5AABF5",r.fillStyle=jt,d?.fill&&(r.fillStyle=r.strokeStyle),r.lineWidth=2/n.scale;const[c,m]=h(i);r.beginPath(),s==="pos"?r.arc(c,m,o,0,2*Math.PI):(r.moveTo(c,m-o),r.lineTo(c+o,m),r.lineTo(c,m+o),r.lineTo(c-o,m),r.closePath()),r.fill(),r.stroke(),t.mouse.pos!=null&&y!=null&&Math.hypot(...I.sub([c,m],Q(n,t.mouse.pos)))<=o*2&&(t.mouse.action={cursor:"grab",callback:(x,k)=>{me(u,A);const P=Q(n,x),L=q=>{let[j,B]=q;return ue(e.define_rect,n,[j,B])},S=u.current_state.shapeset_value.shapes[A];if(S==null)return{onmove(){},onrelease(){}};function T(q){u.next_drag!=null&&E.execNoSaveUnapplyAction(u,u.next_drag),u.next_drag={kind:"update_pattern",pattern:A,old_pattern:S,new_pattern:q},u.next_drag!=null&&E.execNoSaveAction(u,u.next_drag)}const O=l[s],H=L(P);T(S);const R=q=>{const j=L(q),B=I.sub(j,H);T({strokes:S.strokes.map((F,V)=>V!==y.pt_stroke?F:{...F,points:F.points.map((U,xe)=>xe!==y.pt_point?U:{...U,[s]:I.add(O,B)})})})};return k.setstate(),{onmove(q){R(Q(n,q)),k.setstate()},onrelease(q){R(Q(n,q)),E.execCommitProgress(u),k.setstate()}}}})}function w(l,y,s){r.strokeStyle=qt,r.lineWidth=1/n.scale,r.moveTo(...h(I.add(l.pos,l.prev_control_offset))),r.lineTo(...h(l.pos)),r.lineTo(...h(I.add(l.pos,l.next_control_offset))),r.stroke(),$(l,y,"pos",s),I.eql(l.next_control_offset,[0,0])||$(l,y,"next_control_offset"),I.eql(l.prev_control_offset,[0,0])||$(l,y,"prev_control_offset")}if(Nt(r,e,n,C,e.define_rect,{hover_sequence_item:u.hover_sequence_item,next_pattern:a,mouse_point:f}),r.strokeStyle="black",r.lineWidth=2/n.scale,r.beginPath(),u.tool==="move"&&u.next_pattern==null)for(const[l,y]of _.strokes.entries())for(const[s,d]of y.points.entries())w(d,{pt_stroke:l,pt_point:s});else if(u.tool==="pen"&&a.points.length>0){const l=u.next_pattern?.points??[];f!=null&&w(f,null);for(const[y,s]of l.entries()){let d=y===l.length-1;w(s,null,{fill:d})}}else if(u.tool==="pencil"){r.beginPath();const l=u.pencil_line?.[0];if(l!=null){r.moveTo(...h(l));for(let y=1;y<u.pencil_line.length;y++){const s=h(u.pencil_line[y]);r.lineTo(s[0],s[1])}r.stroke()}}u.tool==="pencil"&&(t.mouse.action={cursor:"default",callback:(l,y)=>{const s=e.modes.define_symbols,d=i=>{let[c,m]=Q(n,i);return ue(e.define_rect,n,[c,m])},o=i=>{const c=d(i);s.pencil_line??=[];const m=s.pencil_line[s.pencil_line.length-1];m!=null&&I.eql(m,c)||s.pencil_line.push(c)};return s.pencil_line=[],o(l),{onmove(i){o(i)},onrelease(i){o(i),E.execCommitProgress(s),y.setstate()}}}}),u.tool==="pen"&&(t.mouse.action={cursor:"url("+vn+"), url("+mn+"), auto",callback:(l,y)=>{const s=e.modes.define_symbols,d=L=>{let[S,T]=Q(n,L);return ue(e.define_rect,n,[S,T])},[o,i]=d(l);s.next_pattern??={...le,points:[]};const c=s.next_pattern,m={pos:[o,i],next_control_offset:[0,0],prev_control_offset:[0,0]};c.points.push(m);const g=[o,i];let x=!1;const k=L=>{m.next_control_offset=I.sub(L,g),m.prev_control_offset=I.sub([0,0],m.next_control_offset)},P=l;return{onmove(L){if(I.distance(P,L)>20&&(x=!0),x){const[S,T]=d(L);k([S,T])}},onrelease(L){const[S,T]=d(L);k([S,T]),y.setstate()}}}})},previewer(e){const t=e.modes.define_symbols;if(t.shape==null)return[];const n=t.shape,r=t.current_state.shapeset_value.shapes,u=Object.hasOwn(r,n)?r[n]:{strokes:[]};return yt(e,[...u.strokes,...t.next_pattern!=null?[t.next_pattern]:[]],At(e.define_rect,{grid:Ct(e)}))},skip_wait_seq_displayed_on_preview:!0};je(["click"]);export{Qn as default};
