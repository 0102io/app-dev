import{u as C,d as O,a as _,aR as G,l as Y,n as F,an as j,p as N,q as V,y as S,ai as W,a8 as H,z as $,aa as z,O as D,aG as P,w as Z,G as U,x as A,v as m,aS as K,aT as J,ab as Q,N as L,j as ee,a1 as te,L as ne,K as re,aU as se,aV as oe,aW as ae,aX as ce,aN as ie,aY as le,aZ as ue,a_ as de,a$ as pe}from"./index--jBmlGKr.js";var fe=A("<div>TODO "),_e=A('<div class="h-32 w-full overflow-x-scroll flex gap-4 pt-4">'),me=A("<button>"),he=A('<div class="block h-full bg-no-repeat bg-center bg-contain">');function B(e,o,t){const n=e.config?.[e.pattern??h];return n==null||!Object.hasOwn(n,o)?t:n[o]}function ge(e,o,t){return e.config_items?.push({name:o,default_value:t,item:{kind:"boolean"}}),B(e,o,t)}function k(e){return ge(e,"Constant Speed",!1)}const h="gradient",v={gradient:{preview(e,o,t){const n=m.getAngle(m.sub([.5,.5],t.center??[.5,.5]));return R(e,s=>m.rotateRad(s.pos,-n)[1],{total_time:1e3,constant_speed:k(t)})}},random_order:{preview(e,o,t){const n=E(t);for(let s=e.length-1;s>0;s--){const r=Math.floor(n()*(s+1));[e[s],e[r]]=[e[r],e[s]]}return e.flatMap((s,r,l)=>[s.index,{delay_ms:1/l.length*1e3}])}},crazy_random:{preview(e,o,t){return X(e,()=>Math.random()),e.map(n=>n.index)}},sonar:{preview(e,o,t){const n=t.center??[.5,.5];return R(e,r=>Math.atan2(r.pos[1]-n[1],r.pos[0]-n[0]),{total_time:1e3,constant_speed:k(t)})}},expanding_circle:{preview(e,o,t){const n=t.center??[0,0];return R(e,r=>m.distance(r.pos,n),{total_time:1e3,constant_speed:k(t)})}},arrow:{preview(e,o,t){const n=t.center?.[1]??0;return R(e,r=>r.pos[0]+Math.abs(r.pos[1]-n),{total_time:1e3,constant_speed:k(t)})}},rain:{preview(e,o,t){const n=E(t),s=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];for(const l of e){const c=Math.floor(l.pos[0]*s.length);s[c].push(l)}X(s,n);for(const l of s)l.sort((c,a)=>c.pos[1]-a.pos[1]);return s.flat().flatMap((l,c,a)=>[l.index,{delay_ms:1/a.length*1e3}])}},wave:{preview:(e,o)=>b(e,o,t=>[t,(Math.sin(2*Math.PI*t)+1)/2])},spiral:{preview:(e,o)=>b(e,o,t=>{const r=16*Math.PI,l=0+(.5-0)*t,c=r*t,a=[.5,.5];return m.add(a,m.mul([l,l],[Math.cos(c),Math.sin(c)]))})},lissajous_curve:{preview(e,o,t){const c=Math.PI/4;return b(e,o,a=>{const i=.5+.5*Math.sin(2*Math.PI*5*a+c),u=.5+.5*Math.sin(2*Math.PI*4*a);return[i,u]})}},heart_curve:{preview(e,o,t){return b(e,o,n=>{const s=n*2*Math.PI,r=16*Math.pow(Math.sin(s),3),l=13*Math.cos(s)-5*Math.cos(2*s)-2*Math.cos(3*s)-Math.cos(4*s),c=.5+r/35,a=.5-l/35;return[c,a]})}},archimedean_spiral:{preview(e,o,t){return b(e,o,n=>{const s=8*Math.PI,r=n*s,l=0,c=.1,a=l+c*r,i=.5/(l+c*s),u=.5+a*Math.cos(r)*i,d=.5+a*Math.sin(r)*i;return[u,d]})}},harmonograph:{preview(e,o,t){const c=Math.PI/4,a=3,i=.012,u=.5,d=Math.PI/3;return b(e,o,f=>{const p=f*20,y=.5+.5*Math.sin(2*p+c)*Math.exp(-.01*p),w=.5+u*Math.sin(a*p+d)*Math.exp(-i*p);return[y,w]},{duration:4e3})}},voronoi:{preview(e,o,t){const n=E(t),s=10,r=new Array(s).fill(0).map((a,i)=>{const u=[n(),n()];return i===0&&t.center!=null&&t.mouse?t.center:u}),l=new Array(s).fill(0).map(()=>[]);for(const a of e){let i=1/0,u=-1;for(let d=0;d<r.length;d++){const f=r[d],p=m.distance(a.pos,f);p<i&&(i=p,u=d)}l[u].push(a)}for(let a=0;a<l.length;a++){const i=r[a];l[a].sort((d,f)=>m.distance(d.pos,i)-m.distance(f.pos,i))}const c=[];for(const a of l){for(const i of a)c.push(i.index);c.push({delay_ms:1e3/s})}return c}}};function E(e){return K(...J(""+(e.random_seed??0)))}function X(e,o){for(let t=0;t<e.length;t++){const n=Math.floor(o()*(e.length-t))+t,s=e[n];e[n]=e[t],e[t]=s}}function R(e,o,t){const n=e.map(i=>[i.index,o(i)]),s=n.reduce((i,u)=>Math.min(i,u[1]),1/0),r=n.reduce((i,u)=>Math.max(i,u[1]),-1/0),l=n.sort((i,u)=>i[1]-u[1]),c=[];let a;for(const i of l)if(c.push(i[0]),t.constant_speed){const u=(i[1]+s)/(r-s)*t.total_time;a!=null&&c.push({delay_ms:u-a}),a=u}else c.push({delay_ms:t.total_time/l.length});return c}function ve(e,o,t){let n=e.settings.on_duration_ms*e.settings.pattern_speed_multiplier;const s=t?.duration??1e3,r=s/2e3;n=Math.max(n,r);let l=0;for(let c=0;c<s;c+=n){if(l+=1,l>3e3){console.warn("iteration too long");break}o(c/s,n)}}function b(e,o,t,n){const s=c=>{let a=null;for(const i of e){const u=m.distance(c,i.pos);(a==null||u<a[1])&&(a=[i.index,u])}return a?.[0]??null};let r=[],l=null;return ve(o,(c,a)=>{const i=s(t(c));i!=null&&i!==l&&(r.push(i),l=i),r.push({delay_ms:a})},n),r}function ye(e,o,t){const n=e.modes.pattern;if(e.play&&n.pattern===t){e.play=!1,o();return}n.pattern=t,T(e,o)}function T(e,o){e.modes.pattern,e.play=!1,o(),e.play=!0,o()}function q(e){return e.split("_").map(o=>o.replaceAll(/\b[a-z]/g,t=>t.toUpperCase())).join(" ")}function we(e){const{state:o,setState:t}=C(L),n=()=>o().modes.pattern,{item:s,default_value:r,name:l}=e.item,c=O(()=>B(n(),l,r)),a=i=>{((n().config??={})[n().pattern??h]??={})[l]=i,t()};return s.kind==="boolean"?_(ee,{label:l,get value(){return c()},setValue:a}):(()=>{var i=fe();return i.firstChild,S(i,()=>e.item.item.kind,null),i})()}function be(e){return _(z,{get each(){return e.items},children:o=>_(we,{item:o})})}const x=new OffscreenCanvas(5,5),xe=new OffscreenCanvas(1,1),I=xe.getContext("2d");let g;async function Me(e,o){g!=null&&await new Promise(t=>g.push(t)),g==null&&(g=[]);try{return await se,await Pe(e,o)}finally{if(g!=null){const t=g.shift();g.length===0&&(g=null),t?.()}}}const M=[83,94];async function Pe(e,o){const t=M[0],n=M[1];x.width!==t&&(x.width=t),x.height!==n&&(x.height=n);const s=new oe(I,x);I.save(),I.clearRect(0,0,M[0],M[1]),s.gl.clearColor(0,0,0,0),s.gl.clear(s.gl.COLOR_BUFFER_BIT);const r=new ae(ce([10,10],"zig")),l=ie([[0,0],[t,n]],r.bounds[0]/r.bounds[1]),c=le(l,r.bounds);s.transform(c);const a=[];for(let p=0;p<r.max_pts;p++){const y=r.ptCenter(p),w=ue(r.define_rect_scaler,y);w[0]<0||w[1]<0||w[0]>1||w[1]>1||a.push({pos:w,index:p})}const i=[],u=v[o]?.preview?.(a,{settings:{on_duration_ms:1,pattern_speed_multiplier:1}},{center:[.5,.5],mouse:!1,config_items:i});if(u==null)return"";(e.config_items_by_pattern??={})[o]=i,de(s,{scale:1},{force_fast_render:!1,noise_on_preview:!1,state_play:!1,grid:r,grayscale:!1,use_rst_new:!0},pe(u,{frame_index:0},{preview_mode_opacity:1}),{force_fast:!1,grid_path:{stroke:[0,0,0,0],fill:[0,0,0,0]}}),I.restore();const d=await x.convertToBlob();return URL.createObjectURL(d)}const Re={sidePanel(){const{state:e,setState:o}=C(L),t=()=>e().modes.pattern,n=O(()=>t().pattern??h),s=O(()=>{const r=t();return r.config_items_by_pattern?.[r.pattern??h]??void 0});return _(F,{collapsible:"Pattern",get children(){return[_(G,{label:"Pattern",get choices(){return Object.keys(v).map(r=>[r,q(r)])},get value(){return n()},setValue:r=>{t().pattern=r??h,o()},names:{none:"",empty_list:""},hide_null_choice:!0}),_(be,{get items(){return s()??[]}}),_(Y,{})]}})},dockPanel(){const{state:e,setState:o}=C(L),t=()=>e().modes.pattern;return j(()=>t().pattern),_(V,{vertical:!0,get children(){return _(N,{get dr_tools_active(){return t().tool==="define_rect"},setDrToolsActive:n=>{n?t().tool="define_rect":t().tool=void 0,o()}})}})},topPanel(){const{state:e,setState:o}=C(L),t=()=>e().modes.pattern,n=j(()=>t().pattern);return(()=>{var s=_e();return S(s,_(z,{get each(){return Object.keys(v)},children:r=>{const l=()=>v[r]?.preview_icon??null;let c=null;const a=i=>{c!=null&&document.body.removeEventListener("mouseup",c,{capture:!0}),c=i,c!=null&&document.body.addEventListener("mouseup",c,{capture:!0})};return(()=>{var i=me();return i.addEventListener("mouseleave",()=>{t().hover_pattern=void 0,o()}),i.addEventListener("mouseenter",()=>{t().hover_pattern!==r&&(t().hover_pattern=r),o()}),i.$$click=()=>{c||(!e().play||t().pattern!==r)&&(t().pattern=r,T(e(),o))},i.$$mousedown=u=>{e().repeat=!0,ye(e(),o,r),a(d=>{a(null),e().repeat&&(e().repeat=!1,o());const f=p=>{p.stopPropagation(),p.stopImmediatePropagation(),document.body.removeEventListener("click",f,{capture:!0})};document.body.addEventListener("click",f,{capture:!0})})},S(i,_(W,{get when(){return l()},get fallback(){return(()=>{var u=he();return H(d=>{let f=null,p=!1;te(()=>{p=!0,f!=null&&URL.revokeObjectURL(f)}),Me(t(),r).then(y=>{if(p){URL.revokeObjectURL(y);return}f=y,d.style.backgroundImage="url("+y+")"})},u),$(d=>{var f=M[0]+" / "+M[1],p=q(r);return f!==d.e&&((d.e=f)!=null?u.style.setProperty("aspect-ratio",f):u.style.removeProperty("aspect-ratio")),p!==d.t&&ne(u,"title",d.t=p),d},{e:void 0,t:void 0}),u})()},children:u=>u})),$(()=>re(i,"h-full bg-white border border-[#C5C8D7] rounded-md p-2 block "+(n(r)?"border-2 border-black":""))),i})()}})),s})()},render({state:e,imev:o,frame:t}){const n=e.modes.pattern;if(n.tool==null){let s=function(r){const l=r!=null?D(t,r):null,c=l!=null?P(e.define_rect,t,l):[.5,.5];n.center=c,n.mouse=r!=null};n.mouse_held||s(o.mouse.pos),o.mouse.action={cursor:"default",callback:(r,l)=>{n.mouse_held=!0;const c=D(t,r);if(n.tool==null){const a=P(e.define_rect,t,c);n.center=a,n.mouse=!0,e.repeat=!0,T(e,l.setstate)}return s(r),{onmove(a){s(a)},onrelease(a){n.mouse_held=!1,s(a),e.repeat&&(e.repeat=!1,l.setstate())}}}}}Z(e,t,o,{enable_resize:n.tool==="define_rect"})},previewer:function(e){const o=e.modes.pattern,t=v[o.hover_pattern??o.pattern??h]??v[h];if(t==null)return[];const n=U(e),s=[];for(let r=0;r<n.max_pts;r++){const l=n.ptCenter(r),c=P(e.define_rect,{grid:n},l);c[0]<0||c[1]<0||c[0]>1||c[1]>1||s.push({pos:c,index:r})}return t.preview?.(s,e,o)??[]},sequencer:function*(e,o){const t=e.modes.pattern,n=v[t.pattern??h]??v[h];if(n==null)return;const s=U(e),r=[];for(let l=0;l<s.max_pts;l++){const c=s.ptCenter(l),a=P(e.define_rect,{grid:s},c);a[0]<0||a[1]<0||a[0]>1||a[1]>1||r.push({pos:a,index:l})}n.sequence!=null?yield*n.sequence(r,e,t):(yield n.preview?.(r,e,t)??[],yield{delay:0}),t.random_seed??=0,t.random_seed+=1}};Q(["mousedown","click"]);export{Re as default};
